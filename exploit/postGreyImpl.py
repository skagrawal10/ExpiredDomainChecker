import psycopg2


def connectToDatabase():
	global conn;
	db = "";
	user = "";
	password = "";
	host = "";
	port = "";
	f = open("config.txt", "rb");
	content = f.read();
	lines = content.split("\n");
	for line in lines:
		if len(line.split("=")) < 2:
			continue;
		param = line.split("=")[0];
		value = line.split("=")[1].replace("\n", "").replace("\r", "").strip();
		if param == "host":
			host = value;
		elif param == "username":
			user = value;
		elif param == "password":
			password = value;
		elif param == "database":
			db = value;
		elif param == "port":
			port = value;
	try:
		print host;
		print db;
		print user;
		print password;
		print port;
		conn = psycopg2.connect(database=db, password=password, user=user,host="localhost", port=port)
		cur = conn.cursor()
		cur.execute("SET client_encoding = 'UTF8'");
		conn.commit();
		 
		print "Connect to database";
		return conn;
	except:
		raise;
		print "I am unable to connect to the database"	
		return None;
		
def executeQuery(query):
	global conn;
	try:
		cur = conn.cursor()
		cur.execute(query);
		conn.commit()
		print "Records created successfully";
		return True;
	except:
		raise;
		return False;
	
	
def insertExploitInDb(EDB, CVE, OSVDBID, VERIFIED, AUTHOR, PUBLISHED, TYPE, title, platform):
	global conn;
	print TYPE;
	if PUBLISHED == "":
		PUBLISHED = "2015-12-03";
	query = "INSERT INTO EXPLOIT_DETAIL VALUES('" + EDB + "','" + CVE + "','" + OSVDBID + "','" + VERIFIED + "','" + AUTHOR+ "','" + PUBLISHED + "','" + TYPE + "','" + title + "','" + platform + "')";
	#print query;
	executeQuery(query);
	

'''	
conn = connectToDatabase("exploitdb", "postgres", "mathura", "localhost", "5432");
insertExploit(conn, "1", "2", "3", "0", "4", "2015-12-03", "6");
'''